# 身份校验 author


## 服务端渲染 - Session

  Session验证一般使用cookie.在express中一般使用express-session统一管理. 唯一不同的是session信息的存储方式有好几种方法.

### 认证流程

1. 客户端发起ajax请求 进行登录
2. 服务端服务端接收登录信息并验证通过
3. 服务端设置res信息(主要是设置cookie通过setCookie字段)并返回数据到客户端
4. 客户端自动从res获取到响应头部信息set-cookie中的值,设置为新的cookie值.
5. 客户端发起第二次ajax请求,会自动携带cookie信息.
6. 服务端从req中获取最新的cookie并验证有效性 有效则正常处理 无效则清理服务端用户登录信息 并返回错误信息(例:登录信息错误)

> Session的局限性：
>> cookie不支持跨域(需要做代理)
>> 当多端登录时session无法保持登录状态
>> cookie可以被禁用

## 前后端分离 - JWT认证机制

JWT认证就是用户认证成功后生成唯一的登录凭证(token).这个登录凭证会被同时保存在前后端(后台可能存储在独立的服务器以应对重复登录和多入口登录问题).此后的每一次通信都需要携带该token.一般使用Authorization请求头传递.

### 认证流程

1. 客户端发起ajax进行登录
2. 服务端接收到ajax  验证登录信息
3. 验证成功后 生成一个登录成功的凭证 并返回给客户端(存储在cookie、Authorization、url或者其他请求头中)
4. 客户端拿到ajax的数据返回 登录成功
5. 客户端发起下一次ajax请求 并携带上一次从后台拿到的登录成功的凭证
6. 服务端接收到ajax 解析登录凭证 验证用户信息 成功则继续 失败则清理用户信息 退出登录

### JWT中间件

- jsonwebtoken
- express-jwt

## 总结

> 注意
> 身份的验证在正常产品开发中一般很复杂 并没有明显的场景区分.在很多场景下都是混合使用,以确保身份认证的可行性和安全性.